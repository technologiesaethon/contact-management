angular.module("contactApp").controller("AdminCtrl",["$scope","$state","httpService",function(a,b,c){a.loggedUser=JSON.parse(sessionStorage.getItem("loggedUser")),c(function(b,c){b?console.log(b):200===c.status&&(a.users=c.data)},{method:"GET",url:"/user"}),a.change=function(a){c(function(a,b){a?console.log(a):console.log(b)},{method:"PUT",url:"/user/"+a._id,headers:{"content-type":"application/json"},data:a})}}]),angular.module("contactApp").controller("ContactCtrl",["$scope","httpService","$state","$modal",function(a,b,c,d){a.loggedUser=JSON.parse(sessionStorage.getItem("loggedUser")),a.formValidation={},b(function(b,c){b?console.log(b):c&&200===c.status&&(a.contacts=c.data)},{method:"GET",url:"/contact"}),a.create=function(){b(function(b,e){b?console.log(b):200===e.status&&(e.data.create?(a.modifiedObject={},a.modifiedObject.user_id=a.loggedUser._id,c.go("contact.create")):d.open({templateUrl:"templates/alert.html",controller:"AlertCtrl",size:"sm",resolve:{alerts:function(){return{alert:"Don't have permission,contact to Admin"}}}}))},{method:"GET",url:"/user/"+a.loggedUser._id})},a.update=function(e){a.submitForm=!1,b(function(b,f){b?console.log(b):200===f.status&&(f.data.update?(a.modifiedObject=angular.copy(e),a.modifiedObject.user_id=a.loggedUser._id,c.go("contact.edit")):d.open({templateUrl:"templates/alert.html",controller:"AlertCtrl",size:"sm",resolve:{alerts:function(){return{alert:"you dont have permission to update it ,contact to Admin"}}}}))},{method:"GET",url:"/user/"+a.loggedUser._id})},a["delete"]=function(c){b(function(e,f){e?console.log(e):200===f.status&&(f.data["delete"]?b(function(b,d){console.log(">>>>>>>>>",b,d),b?console.log(b):d&&200===d.status&&a.contacts.splice(a.contacts.indexOf(c),1)},{method:"DELETE",url:"/contact/"+c._id}):d.open({templateUrl:"templates/alert.html",controller:"AlertCtrl",size:"sm",resolve:{alerts:function(){return{alert:"you dont have permission to delete it ,contact to Admin"}}}}))},{method:"GET",url:"/user/"+a.loggedUser._id})},a.save=function(d){a.modifiedObject._id?b(function(d,e){d?console.log(d):b(function(b,d){b?console.log(b):d&&200===d.status?(a.contacts=d.data,c.go("contact.all")):console.log(">>>>",d.error)},{method:"GET",url:"/contact",params:{user_id:a.loggedUser._id}})},{method:"PUT",headers:{"content-type":"application/json"},url:"/contact/"+a.modifiedObject._id,data:a.modifiedObject}):b(function(d,e){d?console.log(d):b(function(b,d){b?console.log(b):d&&200===d.status?(a.contacts=d.data,c.go("contact.all")):console.log(">>>>",d.error)},{method:"GET",url:"/contact"})},{method:"POST",headers:{"content-type":"application/json"},url:"/contact",data:a.modifiedObject})},a.cancel=function(){a.modifiedObject=null,c.go("contact.all")}}]),angular.module("contactApp").controller("LoginCtrl",["$scope","$modalInstance","$state","httpService",function(a,b,c,d){a.login=function(){a.loginForm.$invalid?a.submitForm=!0:d(function(d,e){d?console.log("error occurs"):200===e.status?(sessionStorage.setItem("loggedUser",JSON.stringify(e.data)),b.close(),"guest"===e.data.role?c.go("contact.all"):c.go("admin.alluser")):500===e.status&&(a.errorMessage=e.error)},{url:"/login",method:"POST",data:a.user})},a.cancel=function(){b.dismiss()}}]),angular.module("contactApp").controller("SignUpCtrl",["$scope","$modalInstance","$state","httpService",function(a,b,c,d){a.signup=function(){a.signUpForm.$invalid?a.submitForm=!0:d(function(d,e){d?console.log(d):200===e.status?(sessionStorage.setItem("loggedUser",JSON.stringify(e.data)),b.close(),c.go("contact.all")):500===e.status&&e.error&&(a.errorMessage=e.error)},{method:"POST",headers:{"content-type":"application/json"},url:"/signup",data:a.user})},a.cancel=function(){b.dismiss()}}]),angular.module("contactApp").controller("MainCtrl",["$scope","$modal","$state","httpService","$window",function(a,b,c,d,e){a.login=function(){var c=b.open({templateUrl:"templates/login.html",controller:"LoginCtrl",size:"sm"});c.result.then(function(){a.loggedUser=JSON.parse(sessionStorage.getItem("loggedUser"))},function(a){})},a.signup=function(){var c=b.open({templateUrl:"templates/signup.html",controller:"SignUpCtrl",size:"sm"});c.result.then(function(){a.loggedUser=JSON.parse(sessionStorage.getItem("loggedUser"))},function(a){})},a.logout=function(){console.log("vikas gadha hai"),d(function(a,b){a?console.log(a):(console.log("Logout successfully"),sessionStorage.removeItem("loggedUser"),e.open("index","_self"))},{method:"GET",url:"/logout"})}}]),angular.module("contactApp").controller("AlertCtrl",["$scope","$modalInstance","alerts",function(a,b,c){console.log("alert controller called"),a.alerts=c,a.ok=function(){b.close()}}]);
angular.module("contactApp").factory("httpService",["$http",function(a){return function(b,c){a(c).success(function(a){console.log("httpService Success ",a),b(null,a)}).error(function(a){console.log("httpService Error: ",a),b(a,null)})}}]);